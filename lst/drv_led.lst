C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DRV_LED
OBJECT MODULE PLACED IN .\out\drv_led.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE src\drv_led.c OPTIMIZE(7,SPEED) BROWSE NOAREGS INCDIR(.\inc) DEFINE(xLDO
                    -_5V) DEBUG OBJECTEXTEND CODE PRINT(.\lst\drv_led.lst) TABS(2) OBJECT(.\out\drv_led.obj)

line level    source

   1          #include  "MC96FD316.h"
   2          #include  "func_def.h"
   3          #include  "types.h"
   4          #include    "drv_led.h"
   5          #include  "drv_battery.h"
   6          
   7          #define   LED_TICK          (10)
   8          
   9          
  10          #define   LED_MODE_REQ        0X01
  11          #define   LED_BATTERY_REQ       0X02
  12          
  13          uint8_t    drv_led_tick;
  14          uint8_t   led_req;
  15          uint8_t   xdata drv_led_state;
  16          uint8_t     xdata drv_led_bat_level;
  17          
  18          uint8_t   xdata led[2];
  19          uint16_t  xdata breath_duty;
  20          uint8_t   xdata breath_dir;
  21          //code uint8_t charge_light_on[8][6]={
  22          //code uint8_t charge_light_on_none[6]= {0x01,0x02,0x04,0x08,0x10,0x20};//none
  23                              /*NONE,LOW, L1   L2,  L3,  L4,  L5   FULL*/
  24          code uint8_t charge_light_on_low[8]=  {0X01, 0X01,0x01,0x02,0x04,0x08,0x10,0x20};//low
  25          code uint8_t charge_light_on_l1[8]=   {0X01, 0X01,0x01,0x03,0x05,0x09,0x11,0x21};//18
  26          code uint8_t charge_light_on_l2[8]=   {0X03, 0X03,0x03,0x03,0x07,0x0b,0x13,0x23};//19
  27          code uint8_t charge_light_on_l3[8]=   {0X07, 0X07,0x07,0x07,0x07,0x0f,0x17,0x27};//20
  28          code uint8_t charge_light_on_l4[8]=   {0X0F, 0X0F,0x0f,0x0f,0x0f,0x0f,0x1f,0x2f};//21
  29          code uint8_t charge_light_on_l5[8]=   {0X1F, 0X1F,0x1f,0x1f,0x1f,0x1f,0x1f,0x3f};//22
  30          //code uint8_t charge_light_on_l6[6]=   {0x3f,0x3f,0x3f,0x3f,0x3f,0x3f};//level6
  31          //};
  32          
  33          /*=========================================================
  34          * FUNCTION NAME: drv_led_set_mode_light
  35          * input :        none
  36          * Output:        none
  37          * description:   period drive the led io to scan led 
  38          *********************************************************
  39          author          release             date
  40          *********************************************************
  41          richy.lee       first release       2022/04/21
  42          ===========================================================*/
  43          void drv_led_set_mode_connect(void){
  44   1        
  45   1      
  46   1          led[0]=0x0f;
  47   1          led_req|=LED_MODE_REQ;  
  48   1      }
  49          
  50          
  51          /*=========================================================
  52          * FUNCTION NAME: drv_led_set_mode_light
  53          * input :        none
  54          * Output:        none
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 2   

  55          * description:   period drive the led io to scan led 
  56          *********************************************************
  57          author          release             date
  58          *********************************************************
  59          richy.lee       first release       2022/04/21
  60          ===========================================================*/
  61          void drv_led_set_mode_light(uint8_t mode){
  62   1        
  63   1      
  64   1          led[0]=(1<<mode);
  65   1          led_req|=LED_MODE_REQ;  
  66   1      }
  67          /*=========================================================
  68          * FUNCTION NAME: drv_led_set_mode_light
  69          * input :        none
  70          * Output:        none
  71          * description:   period drive the led io to scan led 
  72          *********************************************************
  73          author          release             date
  74          *********************************************************
  75          richy.lee       first release       2022/04/21
  76          ===========================================================*/
  77          void drv_led_set_test_mode_light(void){
  78   1        
  79   1          led[0]=0xff;
  80   1          led[1]=0xff;
  81   1          
  82   1          led_req|=LED_MODE_REQ;  
  83   1          led_req|=LED_BATTERY_REQ; 
  84   1      }
  85          
  86          
  87          /*=========================================================
  88          * FUNCTION NAME: drv_led_set_mode_light_off
  89          * input :        none
  90          * Output:        none
  91          * description:   period drive the led io to scan led 
  92          *********************************************************
  93          author          release             date
  94          *********************************************************
  95          richy.lee       first release       2022/04/21
  96          ===========================================================*/
  97          void drv_led_set_mode_light_off(void){
  98   1      
  99   1          led[0]=0;
 100   1          led_req|=LED_MODE_REQ;  
 101   1      
 102   1      }
 103          /*=========================================================
 104          * FUNCTION NAME: drv_led_set_battery_light
 105          * input :        none
 106          * Output:        none
 107          * description:   period drive the led io to scan led 
 108          *********************************************************
 109          author          release             date
 110          *********************************************************
 111          richy.lee       first release       2022/04/21
 112          ===========================================================*/
 113          void drv_led_set_battery_light(uint8_t bat_level){
 114   1      
 115   1          switch(bat_level){
 116   2          case BAT_LOW:
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 3   

 117   2            led[1]=BAT_SEG_LESS_18V0;
 118   2          break;
 119   2          case BAT_LEVEL1:
 120   2            led[1]=BAT_SEG_MORE_18V0;
 121   2          break;
 122   2          case BAT_LEVEL2:
 123   2            led[1]=BAT_SEG_MORE_19V0;
 124   2          break;
 125   2          case  BAT_LEVEL3:
 126   2            led[1]=BAT_SEG_MORE_20V0;
 127   2          break;
 128   2          case BAT_LEVEL4:
 129   2            led[1]=BAT_SEG_MORE_21V0;
 130   2          break;
 131   2          case BAT_LEVEL5:
 132   2            led[1]=BAT_SEG_MORE_22V0;
 133   2          break;
 134   2          case BAT_FULL:
 135   2            led[1]=BAT_SEG_MORE_24V5;
 136   2            break;
 137   2          default:
 138   2            break;
 139   2        }
 140   1        led_req|=LED_BATTERY_REQ; 
 141   1      }
 142          /*=========================================================
 143          * FUNCTION NAME: drv_led_set_battery_light
 144          * input :        none
 145          * Output:        none
 146          * description:   period drive the led io to scan led 
 147          *********************************************************
 148          author          release             date
 149          *********************************************************
 150          richy.lee       first release       2022/04/21
 151          ===========================================================*/
 152          void drv_led_set_battery_charge_light(uint8_t bat_level,uint8_t fl){
 153   1          switch(bat_level){
 154   2          case BAT_NONE:
 155   2          case BAT_LOW:
 156   2            led[1]=charge_light_on_low[fl];
 157   2            break;
 158   2          case BAT_LEVEL1:
 159   2            led[1]=charge_light_on_l1[fl];
 160   2            break;
 161   2          case BAT_LEVEL2:
 162   2            led[1]=charge_light_on_l2[fl];
 163   2            break;
 164   2          case  BAT_LEVEL3:
 165   2            led[1]=charge_light_on_l3[fl];
 166   2            break;
 167   2          case BAT_LEVEL4:
 168   2            led[1]=charge_light_on_l4[fl];
 169   2            break;
 170   2          case BAT_LEVEL5:
 171   2            led[1]=charge_light_on_l5[fl];
 172   2            break;
 173   2          case BAT_FULL:
 174   2            led[1]=0X3F;
 175   2            break;
 176   2          default:
 177   2            break;
 178   2          }
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 4   

 179   1      
 180   1          led_req|=LED_BATTERY_REQ;
 181   1      
 182   1      }
 183          
 184          /*=========================================================
 185          * FUNCTION NAME: drv_led_set_battery_light_off
 186          * input :        none
 187          * Output:        none
 188          * description:   period drive the led io to scan led 
 189          *********************************************************
 190          author          release             date
 191          *********************************************************
 192          richy.lee       first release       2022/04/21
 193          ===========================================================*/
 194          
 195          void drv_led_set_battery_light_off(void){
 196   1      
 197   1          led[1]=0;
 198   1          led_req|=LED_BATTERY_REQ;
 199   1      }
 200          
 201          /*=========================================================
 202          * FUNCTION NAME: drv_set_led_r_duty
 203          * input :        duty
 204          * Output:        none
 205          * description:   period drive the led io to scan led 
 206          *********************************************************
 207          author          release             data
 208          *********************************************************
 209          richy.lee       first release       2022/04/21
 210          ===========================================================*/
 211          void drv_set_led_r_duty(uint16_t duty)
 212          {
 213   1          T3ADRL = duty&0XFF;
 214   1          T3ADRH = (duty>>8)&0xff;
 215   1      
 216   1      }
 217          /*=========================================================
 218          * FUNCTION NAME: drv_set_led_b_duty
 219          * input :        duty
 220          * Output:        none
 221          * description:   period drive the led io to scan led 
 222          *********************************************************
 223          author          release             date
 224          *********************************************************
 225          richy.lee       first release       2022/04/21
 226          ===========================================================*/
 227          void drv_set_led_b_duty(uint16_t duty)
 228          {
 229   1          T3BDRL = duty&0XFF;
 230   1          T3BDRH = (duty>>8)&0xff;
 231   1      
 232   1      }
 233          
 234          /*=========================================================
 235          * FUNCTION NAME: drv_led_set_current_light
 236          * input :        none
 237          * Output:        none
 238          * description:   period drive the led io to scan led 
 239          *********************************************************
 240          author          release             date
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 5   

 241          *********************************************************
 242          richy.lee       first release       2022/04/21
 243          ===========================================================*/
 244          void drv_led_set_current_light(uint8_t current){
 245   1          switch(current){
 246   2          case  LED_CURRENT1://<1A  
 247   2            drv_set_led_b_duty(4000);  //6000
 248   2            drv_set_led_r_duty(0);
 249   2            break;
 250   2      
 251   2          case  LED_CURRENT2://1a<x<3a
 252   2            drv_set_led_b_duty(16000);//
 253   2            drv_set_led_r_duty(0);
 254   2            break;
 255   2          case  LED_CURRENT4://3a<x<4a
 256   2          case  LED_CURRENT5://>4a
 257   2            drv_set_led_b_duty(0);
 258   2            drv_set_led_r_duty(19998);
 259   2            break;
 260   2          default:
 261   2          break;
 262   2          }
 263   1          drv_led_state=0;
 264   1      }
 265          
 266          /*=========================================================
 267          * FUNCTION NAME: drv_set_led_b_duty
 268          * input :        duty
 269          * Output:        none
 270          * description:   period drive the led io to scan led 
 271          *********************************************************
 272          author          release             date
 273          *********************************************************
 274          richy.lee       first release       2022/04/21
 275          ===========================================================*/
 276          void drv_led_set_current_light_reset(void){
 277   1        breath_duty=200;
 278   1        breath_dir=1;
 279   1        drv_set_led_b_duty(0);
 280   1        drv_set_led_r_duty(0);
 281   1      
 282   1      }
 283          /*=========================================================
 284          * FUNCTION NAME: drv_led_write_mode
 285          * input :        duty
 286          * Output:        none
 287          * description:   period drive the led io to scan led 
 288          *********************************************************
 289          author          release             date
 290          *********************************************************
 291          richy.lee       first release       2022/04/21
 292          ===========================================================*/
 293          void drv_led_write_mode(void){
 294   1        if(led[0]&BIT(0)){      SEG0=0; }
 295   1        else{           SEG0=1; }
 296   1        if(led[0]&BIT(1)){      SEG1=0; }
 297   1        else{           SEG1=1; }
 298   1        if(led[0]&BIT(2)){      SEG2=0; }
 299   1        else{           SEG2=1; }
 300   1        if(led[0]&BIT(3)){      SEG3=0; }
 301   1        else{           SEG3=1;}
 302   1      
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 6   

 303   1      
 304   1      
 305   1      }
 306          /*=========================================================
 307          * FUNCTION NAME: drv_led_write_battery
 308          * input :        duty
 309          * Output:        none
 310          * description:   period drive the led io to scan led 
 311          *********************************************************
 312          author          release             date
 313          *********************************************************
 314          richy.lee       first release       2022/04/21
 315          ===========================================================*/
 316          void drv_led_write_battery(void){
 317   1      
 318   1          if(led[1]&BIT(0)){     SEG5=0;}
 319   1          else{            SEG5=1;}
 320   1          
 321   1          if(led[1]&BIT(1)){     SEG4=0;}
 322   1          else{          SEG4=1;}
 323   1      
 324   1          if(led[1]&BIT(2)){     SEG9=0;}
 325   1          else{          SEG9=1;}
 326   1          
 327   1          if(led[1]&BIT(3)){     SEG8=0;}
 328   1          else{          SEG8=1;}
 329   1      
 330   1          
 331   1          if(led[1]&BIT(4)){     SEG7=0;}
 332   1          else{          SEG7=1;}
 333   1      
 334   1          if(led[1]&BIT(5)){    SEG6=0;}
 335   1          else{          SEG6=1;}
 336   1      
 337   1      }
 338          /*=========================================================
 339          * FUNCTION NAME: drv_led
 340          * input :        none
 341          * Output:        none
 342          * description:   period drive the led io to scan led 
 343          *********************************************************
 344          author          release             date
 345          *********************************************************
 346          richy.lee       first release       2022/04/21
 347          ===========================================================*/
 348          void breath_duty_cal(void){
 349   1        if(breath_dir){
 350   2          breath_duty+=100;
 351   2          if(breath_duty>=20000){
 352   3            breath_dir=0;
 353   3          }
 354   2        }else{
 355   2          if(breath_duty>=300){
 356   3            breath_duty-=100;
 357   3          }else{
 358   3            breath_duty=200;
 359   3            breath_dir=1;
 360   3          }
 361   2        }
 362   1      }
 363          /*=========================================================
 364          * FUNCTION NAME: drv_led
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 7   

 365          * input :        none
 366          * Output:        none
 367          * description:   period drive the led io to scan led 
 368          *********************************************************
 369          author          release             date
 370          *********************************************************
 371          richy.lee       first release       2022/04/21
 372          ===========================================================*/
 373          void drv_led(void){
 374   1      
 375   1            if(drv_led_tick<LED_TICK) return;
 376   1          drv_led_tick=0;
 377   1          
 378   1          
 379   1          if(drv_led_state==LED_CHARGE_ON)
 380   1          {
 381   2            breath_duty_cal();
 382   2            if(drv_led_bat_level>=LED_BAT_LEVEL22V0){
 383   3              drv_set_led_r_duty(0);
 384   3              drv_set_led_b_duty(breath_duty);
 385   3            }else{
 386   3              drv_set_led_r_duty(breath_duty);
 387   3              drv_set_led_b_duty(0);
 388   3            }
 389   2          }
 390   1      
 391   1          
 392   1          if(led_req){
 393   2            if((led_req&LED_MODE_REQ)==LED_MODE_REQ){
 394   3              drv_led_write_mode();
 395   3            }
 396   2            if((led_req&LED_BATTERY_REQ)==LED_BATTERY_REQ){
 397   3              drv_led_write_battery();
 398   3            }
 399   2            led_req=0;
 400   2          }
 401   1      
 402   1      }
 403          
 404          
 405          
 406          /*=========================================================
 407          * FUNCTION NAME: drv_led_ini
 408          * input :        duty
 409          * Output:        none
 410          * description:   period drive the led io to scan led 
 411          *********************************************************
 412          author          release             date
 413          *********************************************************
 414          richy.lee       first release       2022/04/21
 415          ===========================================================*/
 416          void drv_led_ini(void){
 417   1        drv_set_led_b_duty(0);
 418   1        drv_set_led_r_duty(0);
 419   1        
 420   1        led[0]=0;
 421   1        led[1]=0;
 422   1        drv_led_write_mode();
 423   1        drv_led_write_battery();
 424   1        drv_led_state=0;
 425   1        drv_led_tick=0;
 426   1      
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 8   

 427   1      }
 428          /*=========================================================
 429          * FUNCTION NAME: drv_led_set_bat_level
 430          * input :        duty
 431          * Output:        none
 432          * description:   period drive the led io to scan led 
 433          *********************************************************
 434          author          release             date
 435          *********************************************************
 436          richy.lee       first release       2022/04/21
 437          ===========================================================*/
 438          
 439          void drv_led_set_bat_level(uint8_t level){
 440   1      
 441   1        drv_led_bat_level=level;
 442   1      
 443   1      
 444   1      }
 445          
 446          /*=========================================================
 447          * FUNCTION NAME: drv_led_set_bat_level
 448          * input :        duty
 449          * Output:        none
 450          * description:   period drive the led io to scan led 
 451          *********************************************************
 452          author          release             date
 453          *********************************************************
 454          richy.lee       first release       2022/04/21
 455          ===========================================================*/
 456          
 457          void drv_led_set_charge_onoff(uint8_t onoff){
 458   1        drv_led_state=onoff;
 459   1      
 460   1      
 461   1      }
 462          
 463          
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 9   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION drv_led_set_mode_connect (BEGIN)
                                           ; SOURCE LINE # 43
                                           ; SOURCE LINE # 46
0000 900000      R     MOV     DPTR,#led
0003 740F              MOV     A,#0FH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 47
0006 430001      R     ORL     led_req,#01H
                                           ; SOURCE LINE # 48
0009 22                RET     
             ; FUNCTION drv_led_set_mode_connect (END)

             ; FUNCTION _drv_led_set_mode_light (BEGIN)
                                           ; SOURCE LINE # 61
;---- Variable 'mode' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 64
0000 EF                MOV     A,R7
0001 F8                MOV     R0,A
0002 7401              MOV     A,#01H
0004 08                INC     R0
0005 8002              SJMP    ?C0077
0007         ?C0076:
0007 C3                CLR     C
0008 33                RLC     A
0009         ?C0077:
0009 D8FC              DJNZ    R0,?C0076
000B 900000      R     MOV     DPTR,#led
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 65
000F 430001      R     ORL     led_req,#01H
                                           ; SOURCE LINE # 66
0012 22                RET     
             ; FUNCTION _drv_led_set_mode_light (END)

             ; FUNCTION drv_led_set_test_mode_light (BEGIN)
                                           ; SOURCE LINE # 77
                                           ; SOURCE LINE # 79
0000 900000      R     MOV     DPTR,#led
0003 74FF              MOV     A,#0FFH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 80
0006 A3                INC     DPTR
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 82
0008 430001      R     ORL     led_req,#01H
                                           ; SOURCE LINE # 83
000B 430002      R     ORL     led_req,#02H
                                           ; SOURCE LINE # 84
000E 22                RET     
             ; FUNCTION drv_led_set_test_mode_light (END)

             ; FUNCTION drv_led_set_mode_light_off (BEGIN)
                                           ; SOURCE LINE # 97
                                           ; SOURCE LINE # 99
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#led
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 100
0005 430001      R     ORL     led_req,#01H
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 10  

                                           ; SOURCE LINE # 102
0008 22                RET     
             ; FUNCTION drv_led_set_mode_light_off (END)

             ; FUNCTION _drv_led_set_battery_light (BEGIN)
                                           ; SOURCE LINE # 113
;---- Variable 'bat_level' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 115
0000 EF                MOV     A,R7
0001 14                DEC     A
0002 B40700            CJNE    A,#07H,?C0078
0005         ?C0078:
0005 5059              JNC     ?C0005
0007 900000      R     MOV     DPTR,#?C0079
000A 75F003            MOV     B,#03H
000D A4                MUL     AB
000E C583              XCH     A,DPH
0010 25F0              ADD     A,B
0012 C583              XCH     A,DPH
0014 73                JMP     @A+DPTR
0015         ?C0079:
0015 020000      R     LJMP    ?C0006
0018 020000      R     LJMP    ?C0007
001B 020000      R     LJMP    ?C0008
001E 020000      R     LJMP    ?C0009
0021 020000      R     LJMP    ?C0010
0024 020000      R     LJMP    ?C0011
0027 020000      R     LJMP    ?C0012
                                           ; SOURCE LINE # 116
002A         ?C0006:
                                           ; SOURCE LINE # 117
002A 900000      R     MOV     DPTR,#led+01H
002D 743E              MOV     A,#03EH
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 118
0030 802E              SJMP    ?C0005
                                           ; SOURCE LINE # 119
0032         ?C0007:
                                           ; SOURCE LINE # 120
0032 900000      R     MOV     DPTR,#led+01H
0035 7401              MOV     A,#01H
0037 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 121
0038 8026              SJMP    ?C0005
                                           ; SOURCE LINE # 122
003A         ?C0008:
                                           ; SOURCE LINE # 123
003A 900000      R     MOV     DPTR,#led+01H
003D 7403              MOV     A,#03H
003F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 124
0040 801E              SJMP    ?C0005
                                           ; SOURCE LINE # 125
0042         ?C0009:
                                           ; SOURCE LINE # 126
0042 900000      R     MOV     DPTR,#led+01H
0045 7407              MOV     A,#07H
0047 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 127
0048 8016              SJMP    ?C0005
                                           ; SOURCE LINE # 128
004A         ?C0010:
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 11  

                                           ; SOURCE LINE # 129
004A 900000      R     MOV     DPTR,#led+01H
004D 740F              MOV     A,#0FH
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 130
0050 800E              SJMP    ?C0005
                                           ; SOURCE LINE # 131
0052         ?C0011:
                                           ; SOURCE LINE # 132
0052 900000      R     MOV     DPTR,#led+01H
0055 741F              MOV     A,#01FH
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 133
0058 8006              SJMP    ?C0005
                                           ; SOURCE LINE # 134
005A         ?C0012:
                                           ; SOURCE LINE # 135
005A 900000      R     MOV     DPTR,#led+01H
005D 743F              MOV     A,#03FH
005F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 136
                                           ; SOURCE LINE # 137
                                           ; SOURCE LINE # 138
                                           ; SOURCE LINE # 139
0060         ?C0005:
                                           ; SOURCE LINE # 140
0060 430002      R     ORL     led_req,#02H
                                           ; SOURCE LINE # 141
0063 22                RET     
             ; FUNCTION _drv_led_set_battery_light (END)

             ; FUNCTION _drv_led_set_battery_charge_light (BEGIN)
                                           ; SOURCE LINE # 152
;---- Variable 'fl' assigned to Register 'R5' ----
;---- Variable 'bat_level' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 153
0000 EF                MOV     A,R7
0001 B40800            CJNE    A,#08H,?C0080
0004         ?C0080:
0004 5067              JNC     ?C0015
0006 900000      R     MOV     DPTR,#?C0081
0009 F8                MOV     R0,A
000A 28                ADD     A,R0
000B 28                ADD     A,R0
000C 73                JMP     @A+DPTR
000D         ?C0081:
000D 020000      R     LJMP    ?C0017
0010 020000      R     LJMP    ?C0017
0013 020000      R     LJMP    ?C0018
0016 020000      R     LJMP    ?C0019
0019 020000      R     LJMP    ?C0020
001C 020000      R     LJMP    ?C0021
001F 020000      R     LJMP    ?C0022
0022 020000      R     LJMP    ?C0023
                                           ; SOURCE LINE # 154
                                           ; SOURCE LINE # 155
0025         ?C0017:
                                           ; SOURCE LINE # 156
0025 ED                MOV     A,R5
0026 900000      R     MOV     DPTR,#charge_light_on_low
0029 93                MOVC    A,@A+DPTR
002A 900000      R     MOV     DPTR,#led+01H
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 12  

002D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 157
002E 803D              SJMP    ?C0015
                                           ; SOURCE LINE # 158
0030         ?C0018:
                                           ; SOURCE LINE # 159
0030 ED                MOV     A,R5
0031 900000      R     MOV     DPTR,#charge_light_on_l1
0034 93                MOVC    A,@A+DPTR
0035 900000      R     MOV     DPTR,#led+01H
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 160
0039 8032              SJMP    ?C0015
                                           ; SOURCE LINE # 161
003B         ?C0019:
                                           ; SOURCE LINE # 162
003B ED                MOV     A,R5
003C 900000      R     MOV     DPTR,#charge_light_on_l2
003F 93                MOVC    A,@A+DPTR
0040 900000      R     MOV     DPTR,#led+01H
0043 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 163
0044 8027              SJMP    ?C0015
                                           ; SOURCE LINE # 164
0046         ?C0020:
                                           ; SOURCE LINE # 165
0046 ED                MOV     A,R5
0047 900000      R     MOV     DPTR,#charge_light_on_l3
004A 93                MOVC    A,@A+DPTR
004B 900000      R     MOV     DPTR,#led+01H
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 166
004F 801C              SJMP    ?C0015
                                           ; SOURCE LINE # 167
0051         ?C0021:
                                           ; SOURCE LINE # 168
0051 ED                MOV     A,R5
0052 900000      R     MOV     DPTR,#charge_light_on_l4
0055 93                MOVC    A,@A+DPTR
0056 900000      R     MOV     DPTR,#led+01H
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 169
005A 8011              SJMP    ?C0015
                                           ; SOURCE LINE # 170
005C         ?C0022:
                                           ; SOURCE LINE # 171
005C ED                MOV     A,R5
005D 900000      R     MOV     DPTR,#charge_light_on_l5
0060 93                MOVC    A,@A+DPTR
0061 900000      R     MOV     DPTR,#led+01H
0064 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 172
0065 8006              SJMP    ?C0015
                                           ; SOURCE LINE # 173
0067         ?C0023:
                                           ; SOURCE LINE # 174
0067 900000      R     MOV     DPTR,#led+01H
006A 743F              MOV     A,#03FH
006C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 175
                                           ; SOURCE LINE # 176
                                           ; SOURCE LINE # 177
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 13  

                                           ; SOURCE LINE # 178
006D         ?C0015:
                                           ; SOURCE LINE # 180
006D 430002      R     ORL     led_req,#02H
                                           ; SOURCE LINE # 182
0070 22                RET     
             ; FUNCTION _drv_led_set_battery_charge_light (END)

             ; FUNCTION drv_led_set_battery_light_off (BEGIN)
                                           ; SOURCE LINE # 195
                                           ; SOURCE LINE # 197
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#led+01H
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 198
0005 430002      R     ORL     led_req,#02H
                                           ; SOURCE LINE # 199
0008 22                RET     
             ; FUNCTION drv_led_set_battery_light_off (END)

             ; FUNCTION _drv_set_led_r_duty (BEGIN)
                                           ; SOURCE LINE # 211
;---- Variable 'duty' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 212
                                           ; SOURCE LINE # 213
0000 EF                MOV     A,R7
0001 F5CA              MOV     T3ADRL,A
                                           ; SOURCE LINE # 214
0003 EE                MOV     A,R6
0004 F5CB              MOV     T3ADRH,A
                                           ; SOURCE LINE # 216
0006 22                RET     
             ; FUNCTION _drv_set_led_r_duty (END)

             ; FUNCTION _drv_set_led_b_duty (BEGIN)
                                           ; SOURCE LINE # 227
;---- Variable 'duty' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 228
                                           ; SOURCE LINE # 229
0000 EF                MOV     A,R7
0001 F5CC              MOV     T3BDRL,A
                                           ; SOURCE LINE # 230
0003 EE                MOV     A,R6
0004 F5CD              MOV     T3BDRH,A
                                           ; SOURCE LINE # 232
0006 22                RET     
             ; FUNCTION _drv_set_led_b_duty (END)

             ; FUNCTION _drv_led_set_current_light (BEGIN)
                                           ; SOURCE LINE # 244
;---- Variable 'current' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 245
0000 EF                MOV     A,R7
0001 14                DEC     A
0002 601A              JZ      ?C0031
0004 24FE              ADD     A,#0FEH
0006 6025              JZ      ?C0033
0008 14                DEC     A
0009 6022              JZ      ?C0033
000B 2404              ADD     A,#04H
000D 702B              JNZ     ?C0029
                                           ; SOURCE LINE # 246
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 14  

000F         ?C0030:
                                           ; SOURCE LINE # 247
000F 7FA0              MOV     R7,#0A0H
0011 7E0F              MOV     R6,#0FH
0013 120000      R     LCALL   _drv_set_led_b_duty
                                           ; SOURCE LINE # 248
0016 E4                CLR     A
0017 FF                MOV     R7,A
0018 FE                MOV     R6,A
0019 120000      R     LCALL   _drv_set_led_r_duty
                                           ; SOURCE LINE # 249
001C 801C              SJMP    ?C0029
                                           ; SOURCE LINE # 251
001E         ?C0031:
                                           ; SOURCE LINE # 252
001E 7F80              MOV     R7,#080H
0020 7E3E              MOV     R6,#03EH
0022 120000      R     LCALL   _drv_set_led_b_duty
                                           ; SOURCE LINE # 253
0025 E4                CLR     A
0026 FF                MOV     R7,A
0027 FE                MOV     R6,A
0028 120000      R     LCALL   _drv_set_led_r_duty
                                           ; SOURCE LINE # 254
002B 800D              SJMP    ?C0029
                                           ; SOURCE LINE # 255
                                           ; SOURCE LINE # 256
002D         ?C0033:
                                           ; SOURCE LINE # 257
002D E4                CLR     A
002E FF                MOV     R7,A
002F FE                MOV     R6,A
0030 120000      R     LCALL   _drv_set_led_b_duty
                                           ; SOURCE LINE # 258
0033 7F1E              MOV     R7,#01EH
0035 7E4E              MOV     R6,#04EH
0037 120000      R     LCALL   _drv_set_led_r_duty
                                           ; SOURCE LINE # 259
                                           ; SOURCE LINE # 260
                                           ; SOURCE LINE # 261
                                           ; SOURCE LINE # 262
003A         ?C0029:
                                           ; SOURCE LINE # 263
003A E4                CLR     A
003B 900000      R     MOV     DPTR,#drv_led_state
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 264
003F 22                RET     
             ; FUNCTION _drv_led_set_current_light (END)

             ; FUNCTION drv_led_set_current_light_reset (BEGIN)
                                           ; SOURCE LINE # 276
                                           ; SOURCE LINE # 277
0000 900000      R     MOV     DPTR,#breath_duty
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 74C8              MOV     A,#0C8H
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 278
0009 900000      R     MOV     DPTR,#breath_dir
000C 7401              MOV     A,#01H
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 15  

000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 279
000F E4                CLR     A
0010 FF                MOV     R7,A
0011 FE                MOV     R6,A
0012 120000      R     LCALL   _drv_set_led_b_duty
                                           ; SOURCE LINE # 280
0015 E4                CLR     A
0016 120000      R     LCALL   _drv_set_led_r_duty
                                           ; SOURCE LINE # 282
0019 22                RET     
             ; FUNCTION drv_led_set_current_light_reset (END)

             ; FUNCTION drv_led_write_mode (BEGIN)
                                           ; SOURCE LINE # 293
                                           ; SOURCE LINE # 294
0000 900000      R     MOV     DPTR,#led
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 30E004            JNB     ACC.0,?C0037
0008 C281              CLR     P01
000A 8002              SJMP    ?C0038
000C         ?C0037:
                                           ; SOURCE LINE # 295
000C D281              SETB    P01
000E         ?C0038:
                                           ; SOURCE LINE # 296
000E EF                MOV     A,R7
000F 30E104            JNB     ACC.1,?C0039
0012 C298              CLR     P30
0014 8002              SJMP    ?C0040
0016         ?C0039:
                                           ; SOURCE LINE # 297
0016 D298              SETB    P30
0018         ?C0040:
                                           ; SOURCE LINE # 298
0018 EF                MOV     A,R7
0019 30E204            JNB     ACC.2,?C0041
001C C28B              CLR     P13
001E 8002              SJMP    ?C0042
0020         ?C0041:
                                           ; SOURCE LINE # 299
0020 D28B              SETB    P13
0022         ?C0042:
                                           ; SOURCE LINE # 300
0022 EF                MOV     A,R7
0023 30E303            JNB     ACC.3,?C0043
0026 C28A              CLR     P12
0028 22                RET     
0029         ?C0043:
                                           ; SOURCE LINE # 301
0029 D28A              SETB    P12
                                           ; SOURCE LINE # 305
002B         ?C0045:
002B 22                RET     
             ; FUNCTION drv_led_write_mode (END)

             ; FUNCTION drv_led_write_battery (BEGIN)
                                           ; SOURCE LINE # 316
                                           ; SOURCE LINE # 318
0000 900000      R     MOV     DPTR,#led+01H
0003 E0                MOVX    A,@DPTR
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 16  

0004 FF                MOV     R7,A
0005 30E004            JNB     ACC.0,?C0046
0008 C291              CLR     P21
000A 8002              SJMP    ?C0047
000C         ?C0046:
                                           ; SOURCE LINE # 319
000C D291              SETB    P21
000E         ?C0047:
                                           ; SOURCE LINE # 321
000E EF                MOV     A,R7
000F 30E104            JNB     ACC.1,?C0048
0012 C290              CLR     P20
0014 8002              SJMP    ?C0049
0016         ?C0048:
                                           ; SOURCE LINE # 322
0016 D290              SETB    P20
0018         ?C0049:
                                           ; SOURCE LINE # 324
0018 EF                MOV     A,R7
0019 30E204            JNB     ACC.2,?C0050
001C C285              CLR     P05
001E 8002              SJMP    ?C0051
0020         ?C0050:
                                           ; SOURCE LINE # 325
0020 D285              SETB    P05
0022         ?C0051:
                                           ; SOURCE LINE # 327
0022 EF                MOV     A,R7
0023 30E304            JNB     ACC.3,?C0052
0026 C284              CLR     P04
0028 8002              SJMP    ?C0053
002A         ?C0052:
                                           ; SOURCE LINE # 328
002A D284              SETB    P04
002C         ?C0053:
                                           ; SOURCE LINE # 331
002C EF                MOV     A,R7
002D 30E404            JNB     ACC.4,?C0054
0030 C299              CLR     P31
0032 8002              SJMP    ?C0055
0034         ?C0054:
                                           ; SOURCE LINE # 332
0034 D299              SETB    P31
0036         ?C0055:
                                           ; SOURCE LINE # 334
0036 EF                MOV     A,R7
0037 30E503            JNB     ACC.5,?C0056
003A C283              CLR     P03
003C 22                RET     
003D         ?C0056:
                                           ; SOURCE LINE # 335
003D D283              SETB    P03
                                           ; SOURCE LINE # 337
003F         ?C0058:
003F 22                RET     
             ; FUNCTION drv_led_write_battery (END)

             ; FUNCTION breath_duty_cal (BEGIN)
                                           ; SOURCE LINE # 348
                                           ; SOURCE LINE # 349
0000 900000      R     MOV     DPTR,#breath_dir
0003 E0                MOVX    A,@DPTR
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 17  

0004 6021              JZ      ?C0059
                                           ; SOURCE LINE # 350
0006 900000      R     MOV     DPTR,#breath_duty+01H
0009 E0                MOVX    A,@DPTR
000A 2464              ADD     A,#064H
000C F0                MOVX    @DPTR,A
000D 900000      R     MOV     DPTR,#breath_duty
0010 E0                MOVX    A,@DPTR
0011 3400              ADDC    A,#00H
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 351
0014 C3                CLR     C
0015 A3                INC     DPTR
0016 E0                MOVX    A,@DPTR
0017 9420              SUBB    A,#020H
0019 900000      R     MOV     DPTR,#breath_duty
001C E0                MOVX    A,@DPTR
001D 944E              SUBB    A,#04EH
001F 4031              JC      ?C0064
                                           ; SOURCE LINE # 352
0021 E4                CLR     A
0022 900000      R     MOV     DPTR,#breath_dir
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 353
                                           ; SOURCE LINE # 354
0026 22                RET     
0027         ?C0059:
                                           ; SOURCE LINE # 355
0027 C3                CLR     C
0028 900000      R     MOV     DPTR,#breath_duty+01H
002B E0                MOVX    A,@DPTR
002C 942C              SUBB    A,#02CH
002E 900000      R     MOV     DPTR,#breath_duty
0031 E0                MOVX    A,@DPTR
0032 9401              SUBB    A,#01H
0034 400D              JC      ?C0062
                                           ; SOURCE LINE # 356
0036 A3                INC     DPTR
0037 E0                MOVX    A,@DPTR
0038 249C              ADD     A,#09CH
003A F0                MOVX    @DPTR,A
003B 900000      R     MOV     DPTR,#breath_duty
003E E0                MOVX    A,@DPTR
003F 34FF              ADDC    A,#0FFH
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 357
0042 22                RET     
0043         ?C0062:
                                           ; SOURCE LINE # 358
0043 900000      R     MOV     DPTR,#breath_duty
0046 E4                CLR     A
0047 F0                MOVX    @DPTR,A
0048 A3                INC     DPTR
0049 74C8              MOV     A,#0C8H
004B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 359
004C 900000      R     MOV     DPTR,#breath_dir
004F 7401              MOV     A,#01H
0051 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 360
                                           ; SOURCE LINE # 361
                                           ; SOURCE LINE # 362
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 18  

0052         ?C0064:
0052 22                RET     
             ; FUNCTION breath_duty_cal (END)

             ; FUNCTION drv_led (BEGIN)
                                           ; SOURCE LINE # 373
                                           ; SOURCE LINE # 375
0000 C3                CLR     C
0001 E500        R     MOV     A,drv_led_tick
0003 940A              SUBB    A,#0AH
0005 7480              MOV     A,#080H
0007 9480              SUBB    A,#080H
0009 405A              JC      ?C0066
                                           ; SOURCE LINE # 376
000B E4                CLR     A
000C F500        R     MOV     drv_led_tick,A
                                           ; SOURCE LINE # 379
000E 900000      R     MOV     DPTR,#drv_led_state
0011 E0                MOVX    A,@DPTR
0012 6401              XRL     A,#01H
0014 7034              JNZ     ?C0067
                                           ; SOURCE LINE # 380
                                           ; SOURCE LINE # 381
0016 120000      R     LCALL   breath_duty_cal
                                           ; SOURCE LINE # 382
0019 900000      R     MOV     DPTR,#drv_led_bat_level
001C E0                MOVX    A,@DPTR
001D C3                CLR     C
001E 9406              SUBB    A,#06H
0020 7480              MOV     A,#080H
0022 9480              SUBB    A,#080H
0024 4013              JC      ?C0068
                                           ; SOURCE LINE # 383
0026 E4                CLR     A
0027 FF                MOV     R7,A
0028 FE                MOV     R6,A
0029 120000      R     LCALL   _drv_set_led_r_duty
                                           ; SOURCE LINE # 384
002C 900000      R     MOV     DPTR,#breath_duty
002F E0                MOVX    A,@DPTR
0030 FE                MOV     R6,A
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
0033 FF                MOV     R7,A
0034 120000      R     LCALL   _drv_set_led_b_duty
                                           ; SOURCE LINE # 385
0037 8011              SJMP    ?C0067
0039         ?C0068:
                                           ; SOURCE LINE # 386
0039 900000      R     MOV     DPTR,#breath_duty
003C E0                MOVX    A,@DPTR
003D FE                MOV     R6,A
003E A3                INC     DPTR
003F E0                MOVX    A,@DPTR
0040 FF                MOV     R7,A
0041 120000      R     LCALL   _drv_set_led_r_duty
                                           ; SOURCE LINE # 387
0044 E4                CLR     A
0045 FF                MOV     R7,A
0046 FE                MOV     R6,A
0047 120000      R     LCALL   _drv_set_led_b_duty
                                           ; SOURCE LINE # 388
C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 19  

                                           ; SOURCE LINE # 389
004A         ?C0067:
                                           ; SOURCE LINE # 392
004A E500        R     MOV     A,led_req
004C 6017              JZ      ?C0066
                                           ; SOURCE LINE # 393
004E 5401              ANL     A,#01H
0050 6401              XRL     A,#01H
0052 7003              JNZ     ?C0071
                                           ; SOURCE LINE # 394
0054 120000      R     LCALL   drv_led_write_mode
                                           ; SOURCE LINE # 395
0057         ?C0071:
                                           ; SOURCE LINE # 396
0057 E500        R     MOV     A,led_req
0059 5402              ANL     A,#02H
005B 6402              XRL     A,#02H
005D 7003              JNZ     ?C0072
                                           ; SOURCE LINE # 397
005F 120000      R     LCALL   drv_led_write_battery
                                           ; SOURCE LINE # 398
0062         ?C0072:
                                           ; SOURCE LINE # 399
0062 E4                CLR     A
0063 F500        R     MOV     led_req,A
                                           ; SOURCE LINE # 400
                                           ; SOURCE LINE # 402
0065         ?C0066:
0065 22                RET     
             ; FUNCTION drv_led (END)

             ; FUNCTION drv_led_ini (BEGIN)
                                           ; SOURCE LINE # 416
                                           ; SOURCE LINE # 417
0000 E4                CLR     A
0001 FF                MOV     R7,A
0002 FE                MOV     R6,A
0003 120000      R     LCALL   _drv_set_led_b_duty
                                           ; SOURCE LINE # 418
0006 E4                CLR     A
0007 120000      R     LCALL   _drv_set_led_r_duty
                                           ; SOURCE LINE # 420
000A E4                CLR     A
000B 900000      R     MOV     DPTR,#led
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 421
000F A3                INC     DPTR
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 422
0011 120000      R     LCALL   drv_led_write_mode
                                           ; SOURCE LINE # 423
0014 120000      R     LCALL   drv_led_write_battery
                                           ; SOURCE LINE # 424
0017 E4                CLR     A
0018 900000      R     MOV     DPTR,#drv_led_state
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 425
001C F500        R     MOV     drv_led_tick,A
                                           ; SOURCE LINE # 427
001E 22                RET     
             ; FUNCTION drv_led_ini (END)

C51 COMPILER V9.59.0.0   DRV_LED                                                           06/28/2022 11:43:44 PAGE 20  

             ; FUNCTION _drv_led_set_bat_level (BEGIN)
                                           ; SOURCE LINE # 439
;---- Variable 'level' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 441
0000 900000      R     MOV     DPTR,#drv_led_bat_level
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 444
0005 22                RET     
             ; FUNCTION _drv_led_set_bat_level (END)

             ; FUNCTION _drv_led_set_charge_onoff (BEGIN)
                                           ; SOURCE LINE # 457
;---- Variable 'onoff' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 458
0000 900000      R     MOV     DPTR,#drv_led_state
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 461
0005 22                RET     
             ; FUNCTION _drv_led_set_charge_onoff (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    715    ----
   CONSTANT SIZE    =     48    ----
   XDATA SIZE       =      7    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
